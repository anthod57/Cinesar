import { useEffect } from "react";
import Head from "next/head";
import { Navbar } from "../components/navbar";
import { Movies } from "../components/movies";
import { News } from "../components/news";
import axios from "axios";
import { Newsletter } from "../components/newsletter";
import { Footer } from "../components/footer";
import { HOST } from "../config";

export default function Home(data) {
  const MENU_LINKS = [
    {
      text: "Accueil",
      link: "/",
    },
    {
      text: "Horaires",
      link: "/horaires",
    },
    {
      text: "Films à l'affiche",
      link: "/films-a-l-affiche",
    },
    {
      text: "Prochainement",
      link: "/prochainement",
    },
    {
      text: "Informations",
      link: "/informations",
    },
    {
      text: "Mon compte",
      link: "/login",
    },
  ];

  useEffect(() => {
    // Make font-awesome css only load once page is fully loaded to avoid render-blocking
    document.getElementById("font-awesome").setAttribute("media", "all");
  }, []);

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link
          rel="preconnect"
          href="https://fonts.gstatic.com"
          crossOrigin="true"
        />
      </Head>

      <Navbar menu={MENU_LINKS} active={0}></Navbar>

      <main>
        <section id="movies" style={{ backgroundColor: "#17192e" }}>
          <Movies
            title={"Films à l'affiche"}
            data={data.nowPlaying}
          ></Movies>
        </section>
        <section id="news">
          <News></News>
        </section>
        <section style={{ backgroundColor: "#17192e" }}>
          <Movies title={"Prochainement"} data={data.upcoming}></Movies>
        </section>
        <section id="newsletter">
          <Newsletter></Newsletter>
        </section>
      </main>
      <Footer menu={MENU_LINKS}></Footer>

      <link
        href={
          "https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@300;400;700&display=swap"
        }
        rel="stylesheet"
      />
      <link
        rel="stylesheet"
        id="font-awesome"
        media="print"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
        crossOrigin="anonymous"
        referrerPolicy="no-referrer"
      />
    </>
  );
}

// Get upcomings and now playing movies
export async function getServerSideProps() {
  const nowPlayingReq = axios.get(`${HOST}/api/movies?from=now_playing`);
  const upcomingReq = axios.get(`${HOST}/api/movies?from=upcoming`);

  const [nowPlaying, upcoming] = await Promise.all([nowPlayingReq, upcomingReq]);

  return {
    props: {
      nowPlaying: nowPlaying.data,
      upcoming: upcoming.data,
    },
  };
};

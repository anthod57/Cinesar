import React, { useEffect } from 'react'
import Head from 'next/head'
import axios from "axios";

import { Navbar } from '../../../components/navbar'
import { Footer } from '../../../components/footer'
import { Movie } from '../../../components/movie'

import { HOST } from '../../../config'
import { MENU_ITEMS } from '../../../data/menu'

const Film = (data) => {

      useEffect(() => {
        // Make font-awesome css only load once page is fully loaded to avoid render-blocking
        document.getElementById("font-awesome").setAttribute("media", "all");
      }, [])


    return (
        <>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
            </Head>

            <Navbar menu={MENU_ITEMS} active={-1}></Navbar>

            <main>
                <Movie data={data.movie} trailer={data.trailerKey}></Movie>
            </main>

            <Footer menu={MENU_ITEMS}></Footer>
        </>
    )
}


export default Film;

// Get movie informations and youtube trailer video key
export async function getServerSideProps(ctx) {
  const movieReq = axios.get(`${HOST}/api/movie?id=${ctx.query.id}`)
  const trailerReq = axios.get(`${HOST}/api/trailer?id=${ctx.query.id}`)

  const [movie, trailerKey] = await Promise.all([movieReq, trailerReq]);

  return {
    props: {
      movie: movie.data,
      trailerKey: trailerKey.data
    },
  }
}